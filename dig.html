<style>

body{ font-family: Courier;
}

</style>
<br><br>
<br><br>
<br><br>
<div id="stage">

</div>

<button onclick="addWorker()">Add Worker</button>
<button onclick="removeWorker()">Remove Worker</button>

<p>Tree: <span id = "tree"></span></p>
<p>Rock: <span id = "rock"></span></p>

<script>

/*********************************************************
To-Do URGENT:

-add ability for workers to dig (and move vertically along the ground) - James

-Add a check for the stage to update necessary visual changes(slopes for dug ground?)

-Add a way to track finished temples

-fix the workers brain, add in the function logic for clearing digging and building
************************************************************
Future Ideas and Goals:

-add enemies
-when finishing a temple you earn favor for upgrades?
-add a shop/upgrades
-add larger temple construction sites
-locally store your progress
-add coinhive
-host on a site

**********************************************************
Suggestions:
Add random gems or fossils durring digging phase



**********************************************************/


/*********************************************************
Adds spans with coordinate based ID's
**********************************************************/
function addSpans(x, y){

	for(i=0;i<x;i++){
	document.getElementById("stage").innerHTML+="|"
		for(k=0;k<y;k++){
			document.getElementById("stage").innerHTML+="<span id='"+k+" "+i+"'>&nbsp;</span>";
		}
	document.getElementById("stage").innerHTML+="|<br>"

	}

}
/*********************************************************
Constructor for objects held in the stage array
for now they just hold the text that displays in the level
for this object
**********************************************************/
function Spot(text){
	this.text = text;
	
}
/*********************************************************
Constructor for the current stage
**********************************************************/
function CurrentStage(x, y){
this.type
this.grid = createArray(x, y);
this.gridFinish = createArray(x, y);
this.y= y;
this.x = x;
this.clears
this.digs
this.tree = 0
this.rock = 0
this.digSpots = new Array();
this.buildSpots = new Array();
}
/*********************************************************
checks if there is any debris on the stage
**********************************************************/
CurrentStage.prototype.debrisCheck = function(){
	for(i=0;i<this.x;i++){
		if(this.grid[i][this.groundFloor].text == "T" || this.grid[i][this.groundFloor].text == ","){
			return true;
		}
	}
	return false;
}
/*********************************************************
returns the next unclaimed dig and changes the value in 
the array to claimed
**********************************************************/
CurrentStage.prototype.nextDig = function(){
	
}
/*********************************************************
Method for the game loop to redraw the stage to track
movement
**********************************************************/
CurrentStage.prototype.draw = function(){

	for(i=0;i<this.x;i++){
	
		for(k=0;k<this.y;k++){
			
			if( this.grid[i][k].text == " ")
			document.getElementById(i+" "+k).innerHTML="&nbsp;";
			else
			document.getElementById(i+" "+k).innerHTML=this.grid[i][k].text;
			
		}

	}
}
/*********************************************************
Method for building your own stage.  Stages are limited to
20x6 right now.
**********************************************************/
CurrentStage.prototype.setupThreeStep = function(){
	//building the initial stage blocks for a 3-step pyramid level
	// T=Tree ,=rock  _=dirt_ground
	var level = "                    "+
				"                    "+
				"                    "+
				"____T_____T___T_____"+
				"____________________"+
				"____________________";
	
	var levelFinish = 	"                    "+
						"   x                "+
						"  xxx               "+
						"_xxxxx______________"+
						"__xxx_______________"+
						"___x________________";
	
	// track the row for debris
	this.groundFloor = 3;
	
	//mark this for removal
	this.clears = 4;
	
	//Entering the level into the array
	var count = 0;
	for(i=0;i<6;i++){
	
		for(k=0;k<20;k++){
			var piece = level.substr(count,1);
			
			this.grid[k][i] = new Spot(piece);
			count++;
		}
	}
	//entering the levelfinish into the gridfinish array
	var count = 0;
	for(i=0;i<6;i++){
	
		for(k=0;k<20;k++){
			var piece = levelFinish.substr(count,1);
			
			this.gridFinish[k][i] = new Spot(piece);
			count++;
		}
	}
	
	//finding the dig spots by comparing level to levelFinish
	for(i=4;i<6;i++){
	
		for(k=0;k<20;k++){
						
			if(this.gridFinish[k][i].text == "x"){
				
				this.digSpots.push(k+" "+i);
				
			}	
		}
	}
	
	//finding build spots
	for(i=0;i<6;i++){
	
		for(k=0;k<20;k++){
						
			if(this.gridFinish[k][i].text == "x"){
				
				this.buildSpots.push(k+" "+i);
				
			}	
		}
	}
}
/*********************************************************
borrowed code from stackoverflow for creating n-dimension array
**********************************************************/
function createArray(length) {
    var arr = new Array(length || 0),
        i = length;

    if (arguments.length > 1) {
        var args = Array.prototype.slice.call(arguments, 1);
        while(i--) arr[length-1 - i] = createArray.apply(this, args);
    }

    return arr;
}
/*********************************************************
little worker, works so hard digging, hauling, and building
**********************************************************/
function Worker(){
	this.x = 19;
	this.y = 3;
	//preplanned target
	this.workTarget="";
		
	// Current Job
	this.job="clearing";
	this.workTarget="";
	//randomizing worker symbol
	var sym = Math.floor(Math.random() * (10 - 0));
	//alert(sym);
	switch(sym) {
    case 0:
        this.text = "☼";
        break;
    case 1:
        this.text = "☺";
        break;
	case 2:
        this.text = "z";
        break;
	case 3:
        this.text = "♥";
        break;
	case 4:
        this.text = "♂";
        break;
	case 5:
        this.text = "♀";
        break;
	case 6:
        this.text = "♠";
        break;
	case 7:
        this.text = "☻";
        break;
	case 8:
        this.text = "♣";
        break;
	case 9:
        this.text = "♦";
        break;
    default:
        this.text = "§";
	}
	
	this.item = "&nbsp;";
	this.clears=0;
	this.digs=0;
	this.builds=0;
}
/*********************************************************
The worker checks to see if he is clearing, digging, or building
**********************************************************/
Worker.prototype.jobCheck=function(){
	//checking for debris
	if (curStage.debrisCheck()){
		return "clearing";
	}
	//no debris
	else{
		//checking hand
		if (this.handCheck()){
			return "clearing";
		}
		//hands empty
		else{
			return "digging";
		}
	}
}
/*********************************************************
The worker checks if he's carrying something
true means yes
**********************************************************/
Worker.prototype.handCheck=function(){
	if( this.item == "&nbsp;"){
		return false;
	}
	return true;
}
/*********************************************************
The worker checks if he's home
**********************************************************/
Worker.prototype.homeCheck=function(){
	if( this.x == 19){
		return true;
	}
	return false;
}
/*********************************************************
The worker moves left
**********************************************************/
Worker.prototype.moveLeft=function(){
	this.x-=1;
}
/*********************************************************
The worker moves right
**********************************************************/
Worker.prototype.moveRight=function(){
	this.x+=1;
}
/*********************************************************
The worker moves left-up
**********************************************************/
Worker.prototype.moveLeftUp=function(){
	this.x-=1;
	this.y-=1;
}
/*********************************************************
The worker moves right-up
**********************************************************/
Worker.prototype.moveRightUp=function(){
	this.x+=1;
	this.y-=1;
}
/*********************************************************
The worker moves right-down
**********************************************************/
Worker.prototype.moveRightDown=function(){
	this.x+=1;
	this.y+=1;
}
/*********************************************************
The worker moves left-down
**********************************************************/
Worker.prototype.moveLeftDown=function(){
	this.x-=1;
	this.y+=1;
}
/*********************************************************
The worker claims a dig spot
**********************************************************/
Worker.prototype.claimDig=function(){
	this.workTarget = curStage.nextDig();
}
/*********************************************************
The worker digs
**********************************************************/
Worker.prototype.dig=function(){

}
/*********************************************************
The worker checks for debris
**********************************************************/
Worker.prototype.checkDebris=function(){
  if(curStage.grid[this.x-1][this.y].text == "_"){
	return false;
  }
	return true;
}
/*********************************************************
The worker picks up debris
**********************************************************/
Worker.prototype.pickupDebris=function(){
  this.item = curStage.grid[this.x-1][this.y].text;
  curStage.grid[this.x-1][this.y].text ="_";
}
/*********************************************************
The worker deposits debris
**********************************************************/
Worker.prototype.pickupDebris=function(){
  this.item = curStage.grid[this.x-1][this.y].text;
  curStage.grid[this.x-1][this.y].text ="_";
}
/*********************************************************
The worker goes to obtain brick
**********************************************************/
Worker.prototype.obtainBrick=function(){

}
/*********************************************************
the worker analyses his situation and act accordingly
to clear the area, dig the pit, and build the temple.
**********************************************************/
Worker.prototype.action= function(){
//clearing
if (this.jobCheck() == "clearing"){
	//alert("yes");
	if(this.handCheck()){
		
		if(this.homeCheck()){
			//Checks if it's a tree
			if (this.item == "T"){
				curStage.tree = curStage.tree + 1;
			}
			else if (this.item == ","){
				curStage.rock = curStage.rock + 1;
			}
			this.item = "&nbsp;";
			document.getElementById("tree").innerHTML = curStage.tree;
			document.getElementById("rock").innerHTML = curStage.rock;
		}
		else{
			this.moveRight();
		}
		
	}
	else{
		if(this.checkDebris()){
			this.pickupDebris();
		}
		else{
			this.moveLeft();
		}
	}
}
//digging
else if (this.jobCheck == "digging"){

	//check if I need work
	//check if there is work
	//obtain a dig location
	//if hands are empty proceed to dig location
	//if at location take dirt_ground
	//if hands full travel right
	//if home drop dirt and remove work target

}
//building
else{

	}

}
/*********************************************************
draws the worker on the screen according to his coords
**********************************************************/
Worker.prototype.draw = function(){
	document.getElementById(this.x+" "+this.y).innerHTML=this.text;
	document.getElementById(this.x+" "+(this.y-1)).innerHTML=this.item;
}
/****************************************************************
Add worker function
*****************************************************************/
function addWorker(){
	workers[numberOfWorkers] = new Worker();
	numberOfWorkers+=1;
}
/****************************************************************
Remove worker function
*****************************************************************/
function removeWorker(){
	if(numberOfWorkers>0)
	{
		numberOfWorkers-=1;
		workers.splice(numberOfWorkers, 1);
	}
}
/****************************************************************
Cycle through workers and do actions
*****************************************************************/
function workCycleAction(){
    for(var w=0;w<numberOfWorkers;w++)
	{
		workers[w].action();
	}
}
/****************************************************************
cycle through and draw the workers
****************************************************************/
function DrawWorkers(){
    for(var w=0;w<numberOfWorkers;w++)
	{
		workers[w].draw();
	}
}

/*********************************************************
runs the game in order, currently 1 tick per sec
**********************************************************/
function gameLoop(){
//alert("tick");
//redraw the stage every tick

workCycleAction();

curStage.draw();

DrawWorkers();

//alert(curStage.debrisCheck());
}

//actual code

//number of workers
numberOfWorkers = 2;

curStage = new CurrentStage(20, 6);

///create worker array
workers = new Array(numberOfWorkers);
//make new workers
for(var w=0;w<numberOfWorkers;w++)
{
	workers[w] = new Worker();
}

//curStage.grid[0][0]=1;

//alert(curStage.grid[0][0]);
//setting up the page
addSpans(6,20);
curStage.setupThreeStep();

var gameclock = setInterval("gameLoop()", 500);

</script>


